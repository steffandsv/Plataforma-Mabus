<%- include('partials/head') %>
    <%- include('partials/header') %>

        <div class="container mx-auto px-4 py-8">
            <div class="mb-6">
                <a href="/licitacoes" class="btn btn-ghost btn-sm">‚Üê Voltar para Licita√ß√µes</a>
            </div>

            <!-- Cabe√ßalho -->
            <div class="card bg-base-100 shadow-xl mb-6">
                <div class="card-body">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h1 class="card-title text-2xl mb-2">
                                <%= licitacao.razao_social_orgao %>
                            </h1>
                            <div class="flex gap-2">
                                <span class="badge badge-lg badge-secondary">
                                    <%= licitacao.modalidade_licitacao %>
                                </span>
                                <% if (licitacao.situacao_compra) { %>
                                    <span class="badge badge-lg badge-outline">
                                        <%= licitacao.situacao_compra %>
                                    </span>
                                    <% } %>
                            </div>
                        </div>
                        <div class="text-right">
                            <% if (licitacao.valor_estimado_total && licitacao.valor_estimado_total> 0) { %>
                                <div class="text-sm text-gray-500">Valor Estimado</div>
                                <div class="text-3xl font-bold text-success">
                                    R$ <%= parseFloat(licitacao.valor_estimado_total).toLocaleString('pt-BR',
                                        {minimumFractionDigits: 2}) %>
                                </div>
                                <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detalhes Tabs -->
            <div role="tablist" class="tabs tabs-bordered mb-4">
                <input type="radio" name="tabs" role="tab" class="tab" aria-label="Informa√ß√µes" checked />
                <div role="tabpanel" class="tab-content p-6 bg-base-100 rounded-b-lg">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Dados do √ìrg√£o -->
                        <div>
                            <h3 class="font-bold text-lg mb-3">üè¢ √ìrg√£o Contratante</h3>
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm text-gray-500">Raz√£o Social:</span>
                                    <p class="font-medium">
                                        <%= licitacao.razao_social_org√£o || 'N/D' %>
                                    </p>
                                </div>
                                <% if (licitacao.cnpj_orgao) { %>
                                    <div>
                                        <span class="text-sm text-gray-500">CNPJ:</span>
                                        <p class="font-medium">
                                            <%= licitacao.cnpj_orgao %>
                                        </p>
                                    </div>
                                    <% } %>
                                        <% if (licitacao.poder || licitacao.esfera) { %>
                                            <div class="flex gap-4">
                                                <% if (licitacao.poder) { %>
                                                    <span class="badge">
                                                        <%= licitacao.poder %>
                                                    </span>
                                                    <% } %>
                                                        <% if (licitacao.esfera) { %>
                                                            <span class="badge">
                                                                <%= licitacao.esfera %>
                                                            </span>
                                                            <% } %>
                                            </div>
                                            <% } %>
                            </div>
                        </div>

                        <!-- Dados da Licita√ß√£o -->
                        <div>
                            <h3 class="font-bold text-lg mb-3">üìã Informa√ß√µes da Licita√ß√£o</h3>
                            <div class="space-y-2">
                                <div>
                                    <span class="text-sm text-gray-500">N√∫mero Sequencial PNCP:</span>
                                    <p class="font-mono">
                                        <%= licitacao.numero_sequencial_pncp %>
                                    </p>
                                </div>
                                <% if (licitacao.numero_controle_pncp) { %>
                                    <div>
                                        <span class="text-sm text-gray-500">N√∫mero de Controle:</span>
                                        <p class="font-mono">
                                            <%= licitacao.numero_controle_pncp %>
                                        </p>
                                    </div>
                                    <% } %>
                                        <% if (licitacao.ano_compra) { %>
                                            <div>
                                                <span class="text-sm text-gray-500">Ano:</span>
                                                <p>
                                                    <%= licitacao.ano_compra %>
                                                </p>
                                            </div>
                                            <% } %>
                            </div>
                        </div>

                        <!-- Datas -->
                        <div>
                            <h3 class="font-bold text-lg mb-3">üìÖ Cronograma</h3>
                            <div class="space-y-2">
                                <% if (licitacao.data_publicacao_pncp) { %>
                                    <div>
                                        <span class="text-sm text-gray-500">Publica√ß√£o:</span>
                                        <p>
                                            <%= new Date(licitacao.data_publicacao_pncp).toLocaleString('pt-BR') %>
                                        </p>
                                    </div>
                                    <% } %>
                                        <% if (licitacao.data_abertura_proposta) { %>
                                            <div>
                                                <span class="text-sm text-gray-500">Abertura de Propostas:</span>
                                                <p>
                                                    <%= new
                                                        Date(licitacao.data_abertura_proposta).toLocaleString('pt-BR')
                                                        %>
                                                </p>
                                            </div>
                                            <% } %>
                                                <% if (licitacao.data_encerramento_proposta) { %>
                                                    <div>
                                                        <span class="text-sm text-gray-500">Encerramento:</span>
                                                        <p>
                                                            <%= new
                                                                Date(licitacao.data_encerramento_proposta).toLocaleString('pt-BR')
                                                                %>
                                                        </p>
                                                    </div>
                                                    <% } %>
                            </div>
                        </div>

                        <!-- Valores -->
                        <div>
                            <h3 class="font-bold text-lg mb-3">üí∞ Valores</h3>
                            <div class="space-y-2">
                                <% if (licitacao.valor_estimado_total) { %>
                                    <div>
                                        <span class="text-sm text-gray-500">Total Estimado:</span>
                                        <p class="text-lg font-bold text-success">
                                            R$ <%= parseFloat(licitacao.valor_estimado_total).toLocaleString('pt-BR',
                                                {minimumFractionDigits: 2}) %>
                                        </p>
                                    </div>
                                    <% } %>
                                        <% if (licitacao.valor_total_homologado) { %>
                                            <div>
                                                <span class="text-sm text-gray-500">Total Homologado:</span>
                                                <p class="text-lg font-bold text-primary">
                                                    R$ <%=
                                                        parseFloat(licitacao.valor_total_homologado).toLocaleString('pt-BR',
                                                        {minimumFractionDigits: 2}) %>
                                                </p>
                                            </div>
                                            <% } %>
                            </div>
                        </div>
                    </div>

                    <!-- Objeto da Compra -->
                    <div class="mt-6">
                        <h3 class="font-bold text-lg mb-2">üéØ Objeto da Compra</h3>
                        <div class="bg-base-200 p-4 rounded-lg">
                            <p class="whitespace-pre-wrap">
                                <%= licitacao.objeto_compra || 'N√£o informado' %>
                            </p>
                        </div>
                    </div>

                    <% if (licitacao.informacao_complementar) { %>
                        <div class="mt-4">
                            <h3 class="font-bold text-lg mb-2">‚ÑπÔ∏è Informa√ß√µes Complementares</h3>
                            <div class="bg-base-200 p-4 rounded-lg">
                                <p class="whitespace-pre-wrap">
                                    <%= licitacao.informacao_complementar %>
                                </p>
                            </div>
                        </div>
                        <% } %>
                </div>

                <input type="radio" name="tabs" role="tab" class="tab" aria-label="Itens (<%= itens.length %>)" />
                <div role="tabpanel" class="tab-content p-6 bg-base-100 rounded-b-lg">
                    <% if (itens.length===0) { %>
                        <div class="alert alert-warning">
                            <span>N√£o h√° itens detalhados dispon√≠veis para esta licita√ß√£o.</span>
                        </div>
                        <% } else { %>
                            <div class="overflow-x-auto">
                                <table class="table table-zebra">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Descri√ß√£o</th>
                                            <th>Qtd</th>
                                            <th>Unidade</th>
                                            <th>Valor Unit.</th>
                                            <th>Valor Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% itens.forEach(item=> { %>
                                            <tr>
                                                <td>
                                                    <%= item.numero_item %>
                                                </td>
                                                <td>
                                                    <%= item.descricao_item %>
                                                </td>
                                                <td>
                                                    <%= item.quantidade %>
                                                </td>
                                                <td>
                                                    <%= item.unidade_medida || '-' %>
                                                </td>
                                                <td>
                                                    <% if (item.valor_unitario_estimado) { %>
                                                        R$ <%=
                                                            parseFloat(item.valor_unitario_estimado).toLocaleString('pt-BR',
                                                            {minimumFractionDigits: 2}) %>
                                                            <% } else { %>
                                                                -
                                                                <% } %>
                                                </td>
                                                <td>
                                                    <% if (item.valor_total_estimado) { %>
                                                        R$ <%=
                                                            parseFloat(item.valor_total_estimado).toLocaleString('pt-BR',
                                                            {minimumFractionDigits: 2}) %>
                                                            <% } else { %>
                                                                -
                                                                <% } %>
                                                </td>
                                            </tr>
                                            <% }) %>
                                    </tbody>
                                </table>
                            </div>
                            <% } %>
                </div>
            </div>
        </div>

        <%- include('partials/footer') %>