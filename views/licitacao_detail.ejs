<%- include('partials/head') %>
    <%- include('partials/header') %>

        <div class="container mx-auto px-4 py-8">
            <!-- Header com T√≠tulo e A√ß√µes -->
            <div class="mb-6">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex-1">
                        <h1 class="text-3xl font-bold mb-2">
                            <i class="fas fa-gavel text-primary"></i>
                            <%= licitacao.razao_social_orgao || '√ìrg√£o n√£o informado' %>
                        </h1>
                        <div class="flex gap-2 flex-wrap mb-3">
                            <span class="badge badge-lg badge-primary">
                                <%= licitacao.modalidade_licitacao || 'N/D' %>
                            </span>
                            <% if (licitacao.situacao_compra) { %>
                                <span class="badge badge-lg badge-outline">
                                    <%= licitacao.situacao_compra %>
                                </span>
                                <% } %>
                                    <% if (licitacao.srp) { %>
                                        <span class="badge badge-lg badge-success">
                                            <i class="fas fa-box-open"></i> SRP
                                        </span>
                                        <% } %>
                                            <% if (licitacao.uf_sigla) { %>
                                                <span class="badge badge-lg badge-ghost">
                                                    <i class="fas fa-map-marker-alt"></i>
                                                    <%= licitacao.uf_sigla %> - <%= licitacao.municipio_nome || 'N/D' %>
                                                </span>
                                                <% } %>
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="flex gap-2 flex-wrap">
                        <% if (licitacao.link_sistema_origem) { %>
                            <a href="<%= licitacao.link_sistema_origem %>" target="_blank" rel="noopener noreferrer"
                                class="btn btn-primary gap-2">
                                <i class="fas fa-file-pdf"></i>
                                Ver Edital
                            </a>
                            <% } %>

                                <% if (licitacao.link_processo_eletronico) { %>
                                    <a href="<%= licitacao.link_processo_eletronico %>" target="_blank"
                                        rel="noopener noreferrer" class="btn btn-secondary gap-2">
                                        <i class="fas fa-folder-open"></i>
                                        Processo Eletr√¥nico
                                    </a>
                                    <% } %>

                                        <a href="/licitacoes" class="btn btn-ghost gap-2">
                                            <i class="fas fa-arrow-left"></i>
                                            Voltar
                                        </a>
                    </div>
                </div>

                <!-- Info R√°pida -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="stat bg-base-200 rounded-lg shadow">
                        <div class="stat-title">Valor Estimado</div>
                        <div class="stat-value text-success text-2xl">
                            <% if (licitacao.valor_estimado_total && licitacao.valor_estimado_total> 0) { %>
                                R$ <%= parseFloat(licitacao.valor_estimado_total).toLocaleString('pt-BR',
                                    {minimumFractionDigits: 2}) %>
                                    <% } else { %>
                                        N√£o informado
                                        <% } %>
                        </div>
                    </div>

                    <div class="stat bg-base-200 rounded-lg shadow">
                        <div class="stat-title">Publica√ß√£o PNCP</div>
                        <div class="stat-value text-primary text-lg">
                            <%= licitacao.data_publicacao_pncp ? new
                                Date(licitacao.data_publicacao_pncp).toLocaleDateString('pt-BR') : 'N/D' %>
                        </div>
                        <div class="stat-desc">
                            <%= licitacao.data_publicacao_pncp ? new
                                Date(licitacao.data_publicacao_pncp).toLocaleTimeString('pt-BR', {hour: '2-digit' ,
                                minute: '2-digit' }) : '' %>
                        </div>
                    </div>

                    <div class="stat bg-base-200 rounded-lg shadow">
                        <div class="stat-title">Abertura Propostas</div>
                        <div class="stat-value text-info text-lg">
                            <%= licitacao.data_abertura_proposta ? new
                                Date(licitacao.data_abertura_proposta).toLocaleDateString('pt-BR') : 'N/D' %>
                        </div>
                    </div>

                    <div class="stat bg-base-200 rounded-lg shadow">
                        <div class="stat-title">N¬∫ Processo</div>
                        <div class="stat-value text-sm">
                            <%= licitacao.processo || licitacao.numero_compra || 'N/D' %>
                        </div>
                        <div class="stat-desc text-xs">
                            Ano: <%= licitacao.ano_compra || 'N/D' %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs de Detalhes -->
            <div role="tablist" class="tabs tabs-bordered">
                <input type="radio" name="tabs" role="tab" class="tab" aria-label="Informa√ß√µes" checked />
                <div role="tabpanel" class="tab-content p-6 bg-base-100 rounded-b-lg">

                    <!-- Objeto da Compra -->
                    <div class="mb-6">
                        <h3 class="font-bold text-lg mb-2 flex items-center gap-2">
                            <i class="fas fa-file-alt text-primary"></i>
                            Objeto da Compra
                        </h3>
                        <div class="bg-base-200 p-4 rounded-lg">
                            <p class="whitespace-pre-wrap">
                                <%= licitacao.objeto_compra || 'N√£o informado' %>
                            </p>
                        </div>
                    </div>

                    <% if (licitacao.informacao_complementar) { %>
                        <div class="mb-6">
                            <h3 class="font-bold text-lg mb-2 flex items-center gap-2">
                                <i class="fas fa-info-circle text-info"></i>
                                Informa√ß√µes Complementares
                            </h3>
                            <div class="bg-base-200 p-4 rounded-lg">
                                <p class="whitespace-pre-wrap">
                                    <%= licitacao.informacao_complementar %>
                                </p>
                            </div>
                        </div>
                        <% } %>

                            <!-- Grid de informa√ß√µes detalhadas -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                                <!-- √ìrg√£o -->
                                <div class="card bg-base-200">
                                    <div class="card-body">
                                        <h3 class="card-title text-md">üè¢ √ìrg√£o Contratante</h3>
                                        <div class="space-y-2 text-sm">
                                            <div><strong>CNPJ:</strong>
                                                <%= licitacao.cnpj_orgao || 'N/D' %>
                                            </div>
                                            <div><strong>Poder:</strong>
                                                <%= licitacao.poder || 'N/D' %>
                                            </div>
                                            <div><strong>Esfera:</strong>
                                                <%= licitacao.esfera || 'N/D' %>
                                            </div>
                                            <% if (licitacao.nome_unidade) { %>
                                                <div><strong>Unidade:</strong>
                                                    <%= licitacao.nome_unidade %>
                                                </div>
                                                <% } %>
                                        </div>
                                    </div>
                                </div>

                                <!-- Localiza√ß√£o -->
                                <div class="card bg-base-200">
                                    <div class="card-body">
                                        <h3 class="card-title text-md">üìç Localiza√ß√£o</h3>
                                        <div class="space-y-2 text-sm">
                                            <div><strong>UF:</strong>
                                                <%= licitacao.uf_nome || 'N/D' %> (<%= licitacao.uf_sigla || 'N/D' %>)
                                            </div>
                                            <div><strong>Munic√≠pio:</strong>
                                                <%= licitacao.municipio_nome || 'N/D' %>
                                            </div>
                                            <% if (licitacao.codigo_ibge) { %>
                                                <div><strong>C√≥digo IBGE:</strong>
                                                    <%= licitacao.codigo_ibge %>
                                                </div>
                                                <% } %>
                                        </div>
                                    </div>
                                </div>

                                <!-- Amparo Legal -->
                                <% if (licitacao.amparo_legal_nome) { %>
                                    <div class="card bg-base-200">
                                        <div class="card-body">
                                            <h3 class="card-title text-md">‚öñÔ∏è Amparo Legal</h3>
                                            <div class="space-y-2 text-sm">
                                                <div><strong>
                                                        <%= licitacao.amparo_legal_nome %>
                                                    </strong></div>
                                                <% if (licitacao.amparo_legal_descricao) { %>
                                                    <div class="text-xs opacity-70">
                                                        <%= licitacao.amparo_legal_descricao %>
                                                    </div>
                                                    <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <% } %>

                                        <!-- Modo de Disputa e Tipo de Instrumento -->
                                        <div class="card bg-base-200">
                                            <div class="card-body">
                                                <h3 class="card-title text-md">‚öôÔ∏è Detalhes Contratuais</h3>
                                                <div class="space-y-2 text-sm">
                                                    <% if (licitacao.modo_disputa_nome) { %>
                                                        <div><strong>Modo de Disputa:</strong>
                                                            <%= licitacao.modo_disputa_nome %>
                                                        </div>
                                                        <% } %>
                                                            <% if (licitacao.tipo_instrumento_nome) { %>
                                                                <div><strong>Instrumento:</strong>
                                                                    <%= licitacao.tipo_instrumento_nome %>
                                                                </div>
                                                                <% } %>
                                                                    <% if (licitacao.usuario_nome) { %>
                                                                        <div><strong>Publicado por:</strong>
                                                                            <%= licitacao.usuario_nome %>
                                                                        </div>
                                                                        <% } %>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Datas Completas -->
                                        <div class="card bg-base-200">
                                            <div class="card-body">
                                                <h3 class="card-title text-md">üìÖ Cronograma Completo</h3>
                                                <div class="space-y-2 text-sm">
                                                    <% if (licitacao.data_inclusao) { %>
                                                        <div><strong>Inclus√£o:</strong>
                                                            <%= new
                                                                Date(licitacao.data_inclusao).toLocaleString('pt-BR') %>
                                                        </div>
                                                        <% } %>
                                                            <% if (licitacao.data_abertura_proposta) { %>
                                                                <div><strong>Abertura:</strong>
                                                                    <%= new
                                                                        Date(licitacao.data_abertura_proposta).toLocaleString('pt-BR')
                                                                        %>
                                                                </div>
                                                                <% } %>
                                                                    <% if (licitacao.data_encerramento_proposta) { %>
                                                                        <div><strong>Encerramento:</strong>
                                                                            <%= new
                                                                                Date(licitacao.data_encerramento_proposta).toLocaleString('pt-BR')
                                                                                %>
                                                                        </div>
                                                                        <% } %>
                                                                            <% if (licitacao.data_atualizacao) { %>
                                                                                <div class="text-xs opacity-70">
                                                                                    <strong>√öltima atualiza√ß√£o:</strong>
                                                                                    <%= new
                                                                                        Date(licitacao.data_atualizacao).toLocaleString('pt-BR')
                                                                                        %>
                                                                                </div>
                                                                                <% } %>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Identificadores -->
                                        <div class="card bg-base-200">
                                            <div class="card-body">
                                                <h3 class="card-title text-md">üî¢ Identificadores</h3>
                                                <div class="space-y-2 text-sm">
                                                    <div class="font-mono text-xs"><strong>PNCP:</strong>
                                                        <%= licitacao.numero_sequencial_pncp %>
                                                    </div>
                                                    <% if (licitacao.numero_compra) { %>
                                                        <div><strong>N√∫mero:</strong>
                                                            <%= licitacao.numero_compra %>
                                                        </div>
                                                        <% } %>
                                                            <% if (licitacao.processo) { %>
                                                                <div><strong>Processo:</strong>
                                                                    <%= licitacao.processo %>
                                                                </div>
                                                                <% } %>
                                                                    <% if (licitacao.sequencial_compra) { %>
                                                                        <div><strong>Sequencial:</strong>
                                                                            <%= licitacao.sequencial_compra %>
                                                                        </div>
                                                                        <% } %>
                                                </div>
                                            </div>
                                        </div>
                            </div>
                </div>

                <input type="radio" name="tabs" role="tab" class="tab" aria-label="Itens (<%= itens.length %>)" />
                <div role="tabpanel" class="tab-content p-6 bg-base-100 rounded-b-lg">
                    <% if (itens.length===0) { %>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>N√£o h√° itens detalhados dispon√≠veis para esta licita√ß√£o.</span>
                        </div>
                        <% } else { %>
                            <div class="overflow-x-auto">
                                <table class="table table-zebra">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Descri√ß√£o</th>
                                            <th>Tipo</th>
                                            <th>Qtd</th>
                                            <th>Unidade</th>
                                            <th>Valor Unit.</th>
                                            <th>Valor Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% itens.forEach(item=> { %>
                                            <tr>
                                                <td>
                                                    <%= item.numero_item %>
                                                </td>
                                                <td>
                                                    <%= item.descricao_item %>
                                                </td>
                                                <td>
                                                    <% if (item.material_ou_servico_nome) { %>
                                                        <span class="badge badge-sm">
                                                            <%= item.material_ou_servico_nome %>
                                                        </span>
                                                        <% } %>
                                                </td>
                                                <td>
                                                    <%= item.quantidade %>
                                                </td>
                                                <td>
                                                    <%= item.unidade_medida || '-' %>
                                                </td>
                                                <td>
                                                    <% if (item.valor_unitario_estimado) { %>
                                                        R$ <%=
                                                            parseFloat(item.valor_unitario_estimado).toLocaleString('pt-BR',
                                                            {minimumFractionDigits: 2}) %>
                                                            <% } else { %>
                                                                -
                                                                <% } %>
                                                </td>
                                                <td>
                                                    <% if (item.valor_total_estimado) { %>
                                                        R$ <%=
                                                            parseFloat(item.valor_total_estimado).toLocaleString('pt-BR',
                                                            {minimumFractionDigits: 2}) %>
                                                            <% } else { %>
                                                                -
                                                                <% } %>
                                                </td>
                                            </tr>
                                            <% }) %>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <th colspan="7" class="text-right">
                                                Total de <%= itens.length %> item(ns)
                                            </th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <% } %>
                </div>
            </div>
        </div>

        <%- include('partials/footer') %>