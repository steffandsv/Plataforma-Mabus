<%- include('partials/header') %>

<div class="container mx-auto px-4 max-w-6xl py-12">
    
    <!-- HEADER -->
    <div class="flex justify-between items-center mb-12">
        <div>
            <h2 class="text-3xl font-black text-white tracking-tight">EAGLE EYES</h2>
            <p class="text-starlight/50 font-mono text-xs tracking-widest">USER ACCESS CONTROL FACILITY</p>
        </div>
        <a href="/" class="btn btn-ghost btn-sm text-starlight hover:bg-white/5"><i class="fas fa-arrow-left mr-2"></i> RETREAT</a>
    </div>

    <!-- ALERTS -->
    <% if (error && error.length > 0) { %>
        <div class="alert alert-error mb-8 shadow-lg text-white font-bold rounded-xl border border-white/10"><i class="fas fa-exclamation-circle"></i> <%= error %></div>
    <% } %>
    <% if (success && success.length > 0) { %>
        <div class="alert alert-success mb-8 shadow-lg text-white font-bold rounded-xl border border-white/10"><i class="fas fa-check-circle"></i> <%= success %></div>
    <% } %>

    <!-- CREATE CARD -->
    <div class="glass-card p-8 rounded-3xl border border-white/10 mb-12 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-neon-purple/20 blur-[50px] pointer-events-none rounded-full"></div>
        
        <h3 class="font-bold text-white mb-6 uppercase tracking-widest text-sm flex items-center gap-2">
            <i class="fas fa-user-plus text-neon-blue"></i> RECRUIT NEW OPERATIVE
        </h3>
        
        <form action="/admin/users" method="POST" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
            <div class="md:col-span-1">
                <input type="text" name="username" class="input w-full bg-black/40 border-transparent focus:border-neon-blue focus:bg-black/60 text-white rounded-xl h-12" placeholder="Codename" required>
            </div>
            <div class="md:col-span-1">
                <input type="password" name="password" class="input w-full bg-black/40 border-transparent focus:border-neon-blue focus:bg-black/60 text-white rounded-xl h-12" placeholder="Passcode" required>
            </div>
            <div class="md:col-span-1">
                <select name="role" class="select w-full bg-black/40 border-transparent focus:border-neon-blue text-white rounded-xl h-12">
                    <option value="user">Operative (User)</option>
                    <option value="moderator">Officer (Mod)</option>
                    <option value="admin">Commander (Admin)</option>
                </select>
            </div>
            <div class="md:col-span-1">
                <button type="submit" class="btn btn-primary w-full h-12 rounded-xl text-black font-bold shadow-[0_0_15px_rgba(0,240,255,0.4)]">
                    <i class="fas fa-plus mr-2"></i> AUTHORIZE
                </button>
            </div>
        </form>
    </div>

    <!-- USERS LIST -->
    <div class="glass-card rounded-3xl border border-white/10 overflow-hidden">
        <div class="p-6 border-b border-white/5 bg-white/5">
            <h3 class="font-bold text-white uppercase tracking-widest text-sm">
                <i class="fas fa-users text-neon-purple mr-2"></i> ACTIVE PERSONNEL
            </h3>
        </div>
        
        <div class="overflow-x-auto">
            <table class="table w-full">
                <thead class="bg-black/40 text-starlight/40 font-mono text-[10px] uppercase tracking-wider">
                    <tr>
                        <th class="pl-6">ID</th>
                        <th>CODENAME</th>
                        <th>CLEARANCE LEVEL</th>
                        <th>INDUCTION DATE</th>
                        <th class="text-right pr-6">PROTOCOL</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    <% users.forEach(u => { %>
                        <tr class="hover:bg-white/5 transition-colors group">
                            <td class="pl-6 font-mono text-xs opacity-50">#<%= u.id %></td>
                            <td class="font-bold text-white"><%= u.username %></td>
                            <td>
                                <form action="/admin/users/role" method="POST" class="inline-block">
                                    <input type="hidden" name="id" value="<%= u.id %>">
                                    <select name="role" class="select select-xs select-ghost w-auto max-w-xs font-bold <%= u.role === 'admin' ? 'text-neon-purple' : (u.role === 'moderator' ? 'text-warning' : 'text-starlight') %>" onchange="this.form.submit()" <%= u.username === 'admin' ? 'disabled' : '' %>>
                                        <option value="user" <%= u.role === 'user' ? 'selected' : '' %>>OPERATIVE</option>
                                        <option value="moderator" <%= u.role === 'moderator' ? 'selected' : '' %>>OFFICER</option>
                                        <option value="admin" <%= u.role === 'admin' ? 'selected' : '' %>>COMMANDER</option>
                                    </select>
                                </form>
                            </td>
                            <td class="text-xs font-mono opacity-60"><%= new Date(u.created_at).toLocaleDateString() %></td>
                            <td class="text-right pr-6">
                                <% if (u.username !== 'admin') { %>
                                    <form action="/admin/users/delete" method="POST" onsubmit="return confirm('Terminate this operative? This action is irreversible.');" class="inline-block">
                                        <input type="hidden" name="id" value="<%= u.id %>">
                                        <button type="submit" class="btn btn-xs btn-ghost text-error opacity-0 group-hover:opacity-100 transition-opacity hover:bg-error/10">
                                            <i class="fas fa-trash"></i> TERMINATE
                                        </button>
                                    </form>
                                <% } else { %>
                                    <i class="fas fa-lock text-starlight/20 text-xs"></i>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>

</div>

<%- include('partials/footer') %>
